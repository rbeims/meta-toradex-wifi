From 60ec81a81e9076cc4f3d4e6eddec0e790509136a Mon Sep 17 00:00:00 2001
From: Drew Moseley <drew@moseleynet.net>
Date: Wed, 18 Aug 2021 10:43:35 -0400
Subject: [PATCH] Revert "modules: inherit TAINT_PROPRIETARY_MODULE"

This reverts commit 7b0496d5c63266f29f4593d0de54c8202e88d336.
---
 include/linux/module.h |  1 -
 kernel/module.c        | 26 --------------------------
 2 files changed, 27 deletions(-)

diff --git a/include/linux/module.h b/include/linux/module.h
index 3e01e01f00cc..6eea5d8e0498 100644
--- a/include/linux/module.h
+++ b/include/linux/module.h
@@ -376,7 +376,6 @@ struct module {
 	unsigned int num_gpl_syms;
 	const struct kernel_symbol *gpl_syms;
 	const s32 *gpl_crcs;
-	bool using_gplonly_symbols;
 
 #ifdef CONFIG_UNUSED_SYMBOLS
 	/* unused exported symbols. */
diff --git a/kernel/module.c b/kernel/module.c
index 59d487b8d8da..41c9896465f6 100644
--- a/kernel/module.c
+++ b/kernel/module.c
@@ -1433,24 +1433,6 @@ static int verify_namespace_is_imported(const struct load_info *info,
 	return 0;
 }
 
-static bool inherit_taint(struct module *mod, struct module *owner)
-{
-	if (!owner || !test_bit(TAINT_PROPRIETARY_MODULE, &owner->taints))
-		return true;
-
-	if (mod->using_gplonly_symbols) {
-		pr_err("%s: module using GPL-only symbols uses symbols from proprietary module %s.\n",
-			mod->name, owner->name);
-		return false;
-	}
-
-	if (!test_bit(TAINT_PROPRIETARY_MODULE, &mod->taints)) {
-		pr_warn("%s: module uses symbols from proprietary module %s, inheriting taint.\n",
-			mod->name, owner->name);
-		set_bit(TAINT_PROPRIETARY_MODULE, &mod->taints);
-	}
-	return true;
-}
 
 /* Resolve a symbol for this module.  I.e. if we find one, record usage. */
 static const struct kernel_symbol *resolve_symbol(struct module *mod,
@@ -1476,14 +1458,6 @@ static const struct kernel_symbol *resolve_symbol(struct module *mod,
 	if (!sym)
 		goto unlock;
 
-	if (license == GPL_ONLY)
-		mod->using_gplonly_symbols = true;
-
-	if (!inherit_taint(mod, owner)) {
-		sym = NULL;
-		goto getname;
-	}
-
 	if (!check_version(info, name, mod, crc)) {
 		sym = ERR_PTR(-EINVAL);
 		goto getname;
-- 
2.32.0

